# MGìºí”¼íƒˆ ì—‘ì…€ êµ¬ì¡° ë¶„ì„ ê²°ê³¼

**ë¶„ì„ ì¼ì‹œ:** 2025-11-07
**ëŒ€ìƒ íŒŒì¼:** `xlsx/mg_capital_2510_vol3.xlsx`

---

## ğŸ“Š í•µì‹¬ ë°œê²¬ ì‚¬í•­

### 1. ë©”ë¦¬ì¸  vs MG ë¹„êµ

| í•­ëª© | ë©”ë¦¬ì¸  ìºí”¼íƒˆ | MGìºí”¼íƒˆ |
|------|--------------|---------|
| **ì”ê°€ìœ¨ ë°©ì‹** | ì°¨ëŸ‰ë³„ ê°œë³„ ê°’ (962ëŒ€) | ë“±ê¸‰ë³„ í…Œì´ë¸” (26-28 ë“±ê¸‰) |
| **ë°ì´í„° ìœ„ì¹˜** | "ì°¨ì¢…" + "ì”ê°€" ì‹œíŠ¸ | "ì°¨ëŸ‰DB" + "ì”ê°€map" ì‹œíŠ¸ |
| **ê³ ì”ê°€ ë³´ì •** | ë“±ê¸‰ë³„ ê³„ìˆ˜ (100%/75%/50%) | ê³ ì • +8% |
| **ì¥ê¸° í”„ë¦¬ë¯¸ì—„** | P/Qì—´ (ì°¨ëŸ‰ë³„, ë“±ê¸‰ ê³„ìˆ˜) | ì—†ìŒ |
| **ê³„ì‚° ë°©ì‹** | ì •ì•¡ë²• + ë³„ë„ ê¸ˆìœµë¹„ìš© | PMT (ì›ë¦¬ê¸ˆê· ë“±ìƒí™˜) |
| **ê¸ˆë¦¬** | ì§ì ‘ ì…ë ¥ (ì˜ˆ: 6.02%) | IRR ì—­ì‚° (ëª©í‘œ 4.8%) |

---

## ğŸ“ MG ì—‘ì…€ êµ¬ì¡°

### ì‹œíŠ¸ êµ¬ì„±

1. **ì°¨ëŸ‰DB** (655í–‰ Ã— 38ì—´)
   - ì°¨ëŸ‰ ë§ˆìŠ¤í„° ì •ë³´
   - ì»¬ëŸ¼ F-I: BRAND, MODEL, ë°°ê¸°ëŸ‰, ì°¨ì¢…ë¶„ë¥˜, ì°¨ëŸ‰ê°€
   - ì»¬ëŸ¼ P: ê³ ì”ê°€ ê°€ëŠ¥ ì—¬ë¶€ (Y/N)
   - ì»¬ëŸ¼ AF-AJ: "ì°¨ë´‡ ê¸°ë³¸" ì”ê°€ìœ¨ (12/24/36/48/60ê°œì›”)
   - **ë“±ê¸‰ ì •ë³´ ì—†ìŒ** (ë³„ë„ ê´€ë¦¬)

2. **ì”ê°€map** (18í–‰ Ã— 44ì—´) â­ í•µì‹¬
   - ë“±ê¸‰ë³„ ì”ê°€ìœ¨ í…Œì´ë¸”
   - **ì—ìŠ¤ì•¤ì¼€ì´ëª¨í„°ìŠ¤ í…Œì´ë¸”** (Row 2-7)
     - ë“±ê¸‰: A, B, C, D, E, ... Z, 27, 28 (ì´ 26ê°œ)
     - ê¸°ê°„: 12/24/36/48/60ê°œì›”
     - ì˜ˆì‹œ: 60ê°œì›”/Eë“±ê¸‰ = 0.50 (50%)
   - **APS í…Œì´ë¸”** (Row 13-18)
     - ë“±ê¸‰: SD1, SD, SC1, SC, SB1, SB, SA1, SA, A~T (ì´ 28ê°œ)
     - ê¸°ê°„: 12/24/36/48/60ê°œì›”

3. **ìš´ìš©ë¦¬ìŠ¤** (801í–‰ Ã— 135ì—´)
   - ê²¬ì ì„œ ë©”ì¸ ì‹œíŠ¸
   - BD ì˜ì—­: ìˆ¨ê²¨ì§„ ì…ë ¥ ì˜ì—­ (ì°¨ëŸ‰, ì¡°ê±´ ì„ íƒ)
   - CI/CP/CQ/CR ì˜ì—­: ê³„ì‚° ë¡œì§
   - CQ32: ìµœì¢… ì›”ë¦¬ìŠ¤ë£Œ

### ë°ì´í„° íë¦„

```
[ì°¨ëŸ‰ ì„ íƒ]
  â””â”€ BD6: ì°¨ëŸ‰ëª… (ì˜ˆ: "X5 30d M Sport xDrive (7ì¸ìŠ¹)")
      â””â”€ VLOOKUP â†’ ì°¨ëŸ‰DB
          â”œâ”€ ì°¨ëŸ‰ê°€ (CI9)
          â””â”€ ê³ ì”ê°€ ê°€ëŠ¥ (CI8)

[ë“±ê¸‰ ì¡°íšŒ]
  â””â”€ CP57: ë“±ê¸‰ (ì˜ˆ: "E")
      â””â”€ INDEX â†’ ì”ê°€map
          â””â”€ CP59: ê¸°ë³¸ ì”ê°€ìœ¨ (0.50)

[ì”ê°€ìœ¨ ë³´ì •]
  â”œâ”€ CQ59 = CP59 + ì£¼í–‰ê±°ë¦¬ ë³´ì •
  â”‚   â””â”€ 20,000km: ê¸°ì¤€ (ë³´ì • ì—†ìŒ)
  â”‚   â””â”€ 30,000km: -4%
  â”‚   â””â”€ 10,000km: +0.5%
  â””â”€ CR59 = CQ59 + ê³ ì”ê°€ ë³´ì •
      â””â”€ ê³ ì”ê°€ ê°€ëŠ¥ ì‹œ: +8%
      â””â”€ ìµœì¢…: 0.58 (58%)

[ì›”ë¦¬ìŠ¤ë£Œ ê³„ì‚°]
  â””â”€ CQ29 = PMT(ê¸ˆë¦¬/12, ê¸°ê°„, -ì·¨ë“ì›ê°€, ì”ì¡´ê°€ì¹˜)
      â”œâ”€ ê¸ˆë¦¬: IRR 4.8%ì—ì„œ ì—­ì‚° (ì•½ 5.15%)
      â”œâ”€ ê¸°ê°„: 60ê°œì›”
      â”œâ”€ ì·¨ë“ì›ê°€: 169,756,360ì›
      â””â”€ ì”ì¡´ê°€ì¹˜: 92,568,000ì› (ì°¨ëŸ‰ê°€ Ã— ì”ì¡´ìœ¨)
```

---

## ğŸ” í•µì‹¬ ê³µì‹ ë¶„ì„

### 1. ì”ê°€ìœ¨ ì¡°íšŒ (CP59)

**ìœ„ì¹˜:** ìš´ìš©ë¦¬ìŠ¤!CP59
**ê³µì‹:**
```excel
=IFERROR(
  INDEX(
    ì”ê°€map!$C$3:$AB$7,
    MATCH(ìš´ìš©ë¦¬ìŠ¤!$CI$24, ì”ê°€map!$B$3:$B$7, 0),
    MATCH(ìš´ìš©ë¦¬ìŠ¤!$CP$57, ì”ê°€map!$C$2:$AB$2, 0)
  ),
  0%
)
```

**í•´ì„:**
- CI24: ê³„ì•½ ê¸°ê°„ (60ê°œì›”)
- CP57: ë“±ê¸‰ (E)
- ì”ê°€map C3:AB7: ì—ìŠ¤ì•¤ì¼€ì´ëª¨í„°ìŠ¤ í…Œì´ë¸”
- ê²°ê³¼: 60ê°œì›”/Eë“±ê¸‰ â†’ 0.50

### 2. ì£¼í–‰ê±°ë¦¬ ë³´ì • (CQ59)

**ê³µì‹:**
```excel
=IF($BD$26=35000, $CP$59-2%,
  IF($BD$26=30000, $CP$59-4%,
    IF($BD$26=20000, $CP$59,
      IF($BD$26=10000, $CP$59+0.5%, 0%)
    )
  )
)
```

**ë³´ì •í‘œ:**
| ì£¼í–‰ê±°ë¦¬ | ë³´ì • |
|----------|------|
| 10,000km | +0.5% |
| 20,000km | ê¸°ì¤€ (0%) |
| 30,000km | -4% |
| 35,000km | -2% |

### 3. ê³ ì”ê°€ ë³´ì • (CR59)

**ê³µì‹:**
```excel
=IF(AND($CI$8="Y"), $CQ$59+8%, $CQ$59) + 0.000000001%
```

**í•´ì„:**
- CI8: ê³ ì”ê°€ ê°€ëŠ¥ ì—¬ë¶€ (ì°¨ëŸ‰DB VLOOKUP)
- ê³ ì”ê°€ ê°€ëŠ¥ â†’ +8%p
- ë©”ë¦¬ì¸ ì™€ ë‹¬ë¦¬ **ê³ ì • 8%** (ë“±ê¸‰ ê³„ìˆ˜ ì—†ìŒ)

### 4. ì›”ë¦¬ìŠ¤ë£Œ ê³„ì‚° (CQ29)

**ê³µì‹:**
```excel
=ROUNDDOWN(PMT(CQ28/12, CQ4, -CQ8, CQ24), 0)
```

**íŒŒë¼ë¯¸í„°:**
- CQ28: ì—° ê¸ˆë¦¬ (5.153%, IRRì—ì„œ ì—­ì‚°)
- CQ4: ê³„ì•½ ê¸°ê°„ (60ê°œì›”)
- CQ8: ì·¨ë“ì›ê°€ (169,756,360ì›)
- CQ24: ì”ì¡´ê°€ì¹˜ (92,568,000ì›)

**ê³„ì‚° ë°©ì‹:**
- **ì›ë¦¬ê¸ˆê· ë“±ìƒí™˜ (Annuity)** ë°©ì‹
- ë©”ë¦¬ì¸ ì˜ ì •ì•¡ë²•ê³¼ ì™„ì „íˆ ë‹¤ë¦„
- ë§¤ì›” ë™ì¼í•œ ê¸ˆì•¡ ë‚©ë¶€

### 5. ê¸ˆë¦¬ ì—­ì‚° (CQ27)

**ê³µì‹:**
```excel
=RATE($CQ$4, $CQ$26, -$CQ$8+$CQ$19, $CQ$24) * 12
```

**í•´ì„:**
- ëª©í‘œ IRR 4.8%ë¥¼ ë§ì¶”ê¸° ìœ„í•´ RATE í•¨ìˆ˜ë¡œ ì‹¤ì œ ê¸ˆë¦¬ ì—­ì‚°
- ì—‘ì…€ PMTì™€ RATEì˜ ì—­í•¨ìˆ˜ ê´€ê³„ ì´ìš©
- ë©”ë¦¬ì¸ ëŠ” ê¸ˆë¦¬ ì§ì ‘ ì‚¬ìš© (6.02%)

---

## ğŸ“‹ ì¶”ì¶œí•´ì•¼ í•  ë°ì´í„°

### 1. ì°¨ëŸ‰ ë§ˆìŠ¤í„° (ì°¨ëŸ‰DB ì‹œíŠ¸)

```python
{
  "BMW_X5_30D_M_SPORT_XDRIVE_7": {
    "brand": "BMW",
    "model": "X5 30d M Sport xDrive (7ì¸ìŠ¹)",
    "displacement": 2993,
    "vehicle_type": "ìŠ¹ìš©SUV(7~10ì¸)",
    "price": 159600000,
    "premium_available": "Y"
  },
  ...
}
```

**ì»¬ëŸ¼ ë§¤í•‘:**
- F (col 6): MODEL
- E (col 5): BRAND
- G (col 7): ë°°ê¸°ëŸ‰
- H (col 8): ì°¨ì¢…ë¶„ë¥˜
- I (col 9): ì°¨ëŸ‰ê°€
- P (col 16): ê³ ì”ê°€ ê°€ëŠ¥

### 2. ì”ê°€ ë“±ê¸‰ í…Œì´ë¸” (ì”ê°€map ì‹œíŠ¸)

```python
{
  "snk": {  # ì—ìŠ¤ì•¤ì¼€ì´ëª¨í„°ìŠ¤
    "grades": ["A", "B", "C", ..., "E", ..., "28"],
    "residual_rates": {
      12: [0.85, 0.84, 0.83, ..., 0.81, ..., 0.58],
      24: [0.77, 0.76, 0.75, ..., 0.73, ..., 0.50],
      36: [0.68, 0.67, 0.66, ..., 0.64, ..., 0.41],
      48: [0.60, 0.59, 0.58, ..., 0.56, ..., 0.33],
      60: [0.54, 0.53, 0.52, ..., 0.50, ..., 0.27]
    }
  },
  "aps": {  # APS
    "grades": ["SD1", "SD", "SC1", ..., "T"],
    "residual_rates": {
      12: [...],
      24: [...],
      ...
    }
  }
}
```

### 3. ì°¨ëŸ‰ë³„ ë“±ê¸‰ ì •ë³´

**ë¬¸ì œì :**
- ì°¨ëŸ‰DBì— ë“±ê¸‰ ì •ë³´ê°€ ì§ì ‘ ì—†ìŒ
- CP57 (ë“±ê¸‰)ì´ ì–´ë””ì„œ ì˜¤ëŠ”ì§€ ì¶”ê°€ ì¡°ì‚¬ í•„ìš”
- ê°€ëŠ¥ì„±:
  1. ë³„ë„ íŒŒì¼/ì‹œíŠ¸
  2. ì°¨ëŸ‰DBì˜ ìˆ¨ê²¨ì§„ ì»¬ëŸ¼
  3. ì‚¬ìš©ì ìˆ˜ë™ ì…ë ¥

**í•´ê²° ë°©ì•ˆ:**
1. CP57 ê³µì‹ í™•ì¸ (VLOOKUP/INDEX ì°¸ì¡°)
2. ì°¨ëŸ‰DB ì „ì²´ ì»¬ëŸ¼ í™•ì¸ (S-AL ì˜ì—­)
3. ìµœì•…ì˜ ê²½ìš°: ê¸°ë³¸ ë“±ê¸‰ í• ë‹¹ (ì˜ˆ: ì¤‘ê°„ ë“±ê¸‰)

---

## ğŸ”„ ê³„ì‚° ë¡œì§ ì°¨ì´

### ë©”ë¦¬ì¸  ë°©ì‹
```python
depreciation = (financed_amount - residual_value) / months
finance_cost = (financed_amount + residual_value) / 2 * (annual_rate / 12)
monthly_payment = depreciation + finance_cost + tax + registration_fee
```

### MG ë°©ì‹
```python
# numpy_financial.pmt() ì‚¬ìš©
monthly_payment = -pmt(
    rate=annual_rate / 12,  # ì›” ê¸ˆë¦¬
    nper=months,            # ê¸°ê°„
    pv=financed_amount,     # í˜„ì¬ê°€ì¹˜ (ì·¨ë“ì›ê°€)
    fv=-residual_value      # ë¯¸ë˜ê°€ì¹˜ (ì”ì¡´ê°€ì¹˜)
)
```

**ì£¼ìš” ì°¨ì´:**
1. ë©”ë¦¬ì¸ : ê°ê°€ìƒê° + ê¸ˆìœµë¹„ìš© **ë¶„ë¦¬ ê³„ì‚°**
2. MG: PMT í•¨ìˆ˜ë¡œ **ì¼ê´„ ê³„ì‚°**
3. MGê°€ ë§¤ì›” ë‚©ë¶€ì•¡ì´ ì™„ì „íˆ ë™ì¼ (ì›ë¦¬ê¸ˆê· ë“±ìƒí™˜)
4. ë©”ë¦¬ì¸ ëŠ” ì´ë¡ ì ìœ¼ë¡œ ë§¤ì›” ë™ì¼í•˜ì§€ë§Œ, ë°˜ì˜¬ë¦¼ ì°¨ì´ ë°œìƒ ê°€ëŠ¥

---

## ğŸ¯ êµ¬í˜„ ê³„íš

### Phase 1: ë°ì´í„° ì¶”ì¶œ âœ… ë¶„ì„ ì™„ë£Œ

- [x] ì°¨ëŸ‰DB êµ¬ì¡° íŒŒì•…
- [x] ì”ê°€map êµ¬ì¡° íŒŒì•…
- [x] ê³„ì‚° ê³µì‹ ì—­ì¶”ì 
- [ ] CP57 ë“±ê¸‰ ì¶œì²˜ í™•ì¸ â³

### Phase 2: Extractor ê°œë°œ

```python
# excel_reverse_engineering/mg_extractor.py

class MGCapitalExtractor:
    def extract_vehicles(self) -> Dict:
        """ì°¨ëŸ‰DBì—ì„œ ì°¨ëŸ‰ ë§ˆìŠ¤í„° ì¶”ì¶œ"""
        pass

    def extract_residual_grade_tables(self) -> Dict:
        """ì”ê°€mapì—ì„œ ë“±ê¸‰ë³„ í…Œì´ë¸” ì¶”ì¶œ"""
        pass

    def extract_vehicle_grades(self) -> Dict:
        """ì°¨ëŸ‰ë³„ ë“±ê¸‰ ì •ë³´ ì¶”ì¶œ (CP57 ì¶œì²˜)"""
        pass
```

### Phase 3: ê³„ì‚° ë¡œì§ êµ¬í˜„

```python
# core/mg_calculator.py

class MGLeaseCalculator:
    def calculate(self, vehicle_price, residual_rate, months,
                  annual_rate, down_payment_rate, **kwargs):
        """
        MG ë°©ì‹ ê³„ì‚° (PMT ì‚¬ìš©)
        """
        import numpy_financial as npf

        acquisition_cost = self._calc_acquisition_cost(vehicle_price, ...)
        residual_value = vehicle_price * residual_rate
        financed_amount = acquisition_cost - down_payment

        monthly_payment = -npf.pmt(
            rate=annual_rate / 12,
            nper=months,
            pv=financed_amount,
            fv=-residual_value
        )

        return {
            "monthly_payment": round(monthly_payment, -2),
            ...
        }
```

### Phase 4: ê²€ì¦

```python
# tools/mg_validator.py

def validate_mg_excel(excel_path: str, tolerance: int = 2000):
    """MG ì—‘ì…€ê³¼ ë¹„êµ ê²€ì¦"""
    # 1. ì—‘ì…€ì—ì„œ ì°¨ëŸ‰, ì¡°ê±´, ê²°ê³¼ ì¶”ì¶œ
    # 2. ìš°ë¦¬ ê³„ì‚°ê¸°ë¡œ ê³„ì‚°
    # 3. ì˜¤ì°¨ í™•ì¸
    pass
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. ë“±ê¸‰ ì •ë³´ í™•ë³´ í•„ìˆ˜
- CP57 (ë“±ê¸‰)ì˜ ì¶œì²˜ë¥¼ ë°˜ë“œì‹œ í™•ì¸
- ì°¨ëŸ‰ë³„ ë“±ê¸‰ ë§¤í•‘ í…Œì´ë¸” í•„ìš”
- ìµœì•…ì˜ ê²½ìš° ê¸°ë³¸ê°’ ì„¤ì • í•„ìš”

### 2. IRR ì—­ì‚° ë³µì¡ë„
- ë©”ë¦¬ì¸ ì²˜ëŸ¼ ë‹¨ìˆœ ê¸ˆë¦¬ê°€ ì•„ë‹˜
- PMTì™€ RATEì˜ ì—­í•¨ìˆ˜ ê´€ê³„
- ì •í™•í•œ ê²€ì¦ì„ ìœ„í•´ ì—‘ì…€ì—ì„œ ê¸ˆë¦¬ ì§ì ‘ ì¶”ì¶œ ê¶Œì¥

### 3. ì£¼í–‰ê±°ë¦¬ ë³´ì •
- ë©”ë¦¬ì¸ ì— ì—†ëŠ” ê¸°ëŠ¥
- ê° ë“±ê¸‰ ì˜µì…˜ë³„ë¡œ ë‹¤ë¥¸ ë³´ì • ë¹„ìœ¨

### 4. numpy_financial ì˜ì¡´ì„±
- Python ê¸°ë³¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì•„ë‹˜
- `pip install numpy-financial` í•„ìš”
- ë˜ëŠ” scipy.optimize ì‚¬ìš©

---

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„

1. **CP57 ë“±ê¸‰ ì¶œì²˜ í™•ì¸** (ìµœìš°ì„ )
   - ìš´ìš©ë¦¬ìŠ¤ ì‹œíŠ¸ì—ì„œ CP57 ê³µì‹ í™•ì¸
   - ì°¨ëŸ‰DBì˜ ìˆ¨ê²¨ì§„ ì»¬ëŸ¼ í™•ì¸
   - ê²¬ì ê´€ë¦¬ììš© ì‹œíŠ¸ í™•ì¸

2. **MG Extractor êµ¬í˜„**
   - ì°¨ëŸ‰ ë§ˆìŠ¤í„° ì¶”ì¶œ
   - ì”ê°€map í…Œì´ë¸” ì¶”ì¶œ
   - ë“±ê¸‰ ë§¤í•‘ ì¶”ì¶œ

3. **MG Calculator êµ¬í˜„**
   - PMT ê¸°ë°˜ ê³„ì‚° ë¡œì§
   - ì£¼í–‰ê±°ë¦¬ ë³´ì • ë¡œì§
   - ê³ ì”ê°€ ë³´ì • ë¡œì§

4. **ê²€ì¦ ë° í†µí•©**
   - ì—‘ì…€ê³¼ ë¹„êµ ê²€ì¦
   - Streamlit UIì— MG ì˜µì…˜ ì¶”ê°€
   - ë©”ë¦¬ì¸ ì™€ ë…ë¦½ì ì¸ ë°ì´í„°/ë¡œì§ ìœ ì§€

---

**Last Updated:** 2025-11-07
**Status:** âœ… ë¶„ì„ ì™„ë£Œ, â³ CP57 ë“±ê¸‰ ì¶œì²˜ í™•ì¸ í•„ìš”
